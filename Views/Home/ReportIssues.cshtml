@model Programming_7312_Part_1.Models.Issue

@{
    ViewData["Title"] = "Report Issues";
}

<h1>Report Issues</h1>

@if (!string.IsNullOrEmpty(ViewBag.SuccessMessage))
{
    <div class="alert alert-success">@ViewBag.SuccessMessage</div>
    <div class="progress" style="height: 20px;">
        <div class="progress-bar bg-success" role="progressbar" style="width: 100%;" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100">
            100%
        </div>
    </div>
    <p>@ViewBag.EngagementMessage</p>
}
else
{
    <!-- Progress bar -->
    <div class="progress mb-3" style="height: 20px;">
        <div class="progress-bar" id="progressBar" role="progressbar"
             style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
            0%
        </div>
    </div>

    <form asp-action="ReportIssues" method="post" enctype="multipart/form-data" id="issueForm">
        <div class="form-group">
            <label for="Location">Location</label>
            <input asp-for="Location" class="form-control" required />
        </div>
        <div class="form-group">
            <label for="Category">Category</label>
            <select asp-for="Category" class="form-control" required>
                @foreach (var cat in ViewBag.Categories)
                {
                    <option value="@cat">@cat</option>
                }
            </select>
        </div>
        <div class="form-group">
            <label for="Description">Description</label>
            <textarea asp-for="Description" class="form-control" rows="5" required></textarea>
        </div>
        <div class="form-group">
            <label for="attachment">Attach Media</label>
            <input type="file" name="attachment" class="form-control-file" />
        </div>
        <button type="submit" class="btn btn-primary">Submit</button>
    </form>
}

<a href="@Url.Action("Index")" class="btn btn-secondary">Back to Main Menu</a>

@section Scripts {
    <script>
        const form = document.getElementById("issueForm");
        if (form) {
            const inputs = form.querySelectorAll("input, textarea, select");
            const progressBar = document.getElementById("progressBar");

            function updateProgress() {
                let filled = 0;
                inputs.forEach(input => {
                    if ((input.type === "file" && input.files.length > 0) ||
                        (input.type !== "file" && input.value.trim() !== "")) {
                        filled++;
                    }
                });
                const percent = Math.round((filled / inputs.length) * 100);
                progressBar.style.width = percent + "%";
                progressBar.textContent = percent + "%";
                progressBar.setAttribute("aria-valuenow", percent);
            }

            inputs.forEach(input => input.addEventListener("input", updateProgress));

            form.addEventListener("submit", function () {
                progressBar.style.width = "100%";
                progressBar.textContent = "100%";
                progressBar.setAttribute("aria-valuenow", "100");
                alert("Issue reported, we will be on it next 🚀");
            });
        }
    </script>
}
